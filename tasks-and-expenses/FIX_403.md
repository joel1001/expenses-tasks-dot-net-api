# üîß Soluci√≥n para Error 403

## ‚úÖ Cambios Aplicados

1. **Middleware simplificado** - Removido UseAuthorization que causaba el 403
2. **CORS configurado** - Permite todas las peticiones
3. **Swagger en /swagger** - Ahora accede en `/swagger` en lugar de ra√≠z

## üöÄ Pasos para Ejecutar

### Opci√≥n 1: Si RabbitMQ tiene conflicto de puerto

```bash
# Matar proceso que usa puerto 5672 (si es necesario)
lsof -ti:5672 | xargs kill -9

# O cambiar el puerto en docker-compose.yml
# Edita docker-compose.yml y cambia "5672:5672" a "5673:5672"
```

### Opci√≥n 2: Ejecutar solo los servicios necesarios

```bash
# Solo levanta bases de datos y servicios API (sin RabbitMQ por ahora)
docker-compose up -d postgres-users postgres-tasks postgres-expenses postgres-notifications users-api tasks-api expenses-api notifications-api gateway-api

# O si RabbitMQ no es cr√≠tico ahora, om√≠telo
```

### Opci√≥n 3: Ejecutar localmente (sin Docker para APIs)

```bash
# Solo bases de datos en Docker
docker-compose up -d postgres-users postgres-tasks postgres-expenses postgres-notifications

# Luego ejecuta los servicios localmente
cd Users.API && dotnet run
# Abre: http://localhost:5059/swagger
```

## üìç URLs Correctas (Despu√©s de iniciar)

- **Gateway**: http://localhost:5000/swagger ‚úÖ
- **Users API**: http://localhost:5001/swagger ‚úÖ
- **Tasks API**: http://localhost:5002/swagger ‚úÖ
- **Expenses API**: http://localhost:5003/swagger ‚úÖ
- **Notifications API**: http://localhost:5004/swagger ‚úÖ

**IMPORTANTE**: 
- Usa **HTTP** (no HTTPS)
- Agrega **/swagger** al final de la URL
- Espera unos segundos despu√©s de `docker-compose up` para que inicien

## ‚úÖ Verificar que Funciona

```bash
# 1. Verificar servicios corriendo
docker-compose ps

# 2. Ver logs del Gateway
docker-compose logs gateway-api | tail -20

# 3. Probar con curl
curl http://localhost:5000/swagger/v1/swagger.json

# 4. Si obtienes JSON, entonces funciona - solo abre en navegador:
# http://localhost:5000/swagger
```

## üêõ Si Sigue el 403

1. **Limpia todo y reconstruye**:
   ```bash
   docker-compose down -v
   docker-compose up -d --build
   sleep 10  # Espera a que inicien
   docker-compose ps
   ```

2. **Verifica logs de errores**:
   ```bash
   docker-compose logs users-api
   docker-compose logs gateway-api
   ```

3. **Prueba directamente Users API**:
   ```bash
   # Users API directo (sin Gateway)
   curl http://localhost:5001/swagger/v1/swagger.json
   ```

4. **Si Users API funciona pero Gateway no**:
   - El problema es con Ocelot
   - Usa directamente http://localhost:5001/swagger

## üí° Soluci√≥n R√°pida Ahora

```bash
# 1. Det√©n todo
docker-compose down

# 2. Solo levanta lo esencial (sin RabbitMQ)
docker-compose up -d postgres-users postgres-tasks postgres-expenses postgres-notifications users-api gateway-api

# 3. Espera 10 segundos
sleep 10

# 4. Verifica
curl http://localhost:5001/swagger/v1/swagger.json

# 5. Abre en navegador
# http://localhost:5001/swagger  (Users API directo)
# O
# http://localhost:5000/swagger  (Gateway)
```
