# Docker Compose para Neon PostgreSQL (cloud)
# Uso: docker-compose -f docker-compose.neon.yml up -d
# Requiere: archivo .env con NEON_CONNECTION_STRING

services:
  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: rabbitmq
    ports:
      - "5673:5672"
      - "15673:15672"
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest
    networks:
      - microservices-network

  users-api:
    build:
      context: .
      dockerfile: Users.API/Dockerfile
    container_name: users-api
    ports:
      - "5001:8080"
    extra_hosts:
      - "ep-small-cell-aiu9egey-pooler.c-4.us-east-1.aws.neon.tech:54.86.249.90"
    env_file:
      - .env
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:8080
      - "ConnectionStrings__DefaultConnection=${NEON_CONNECTION_STRING}"
    networks:
      - microservices-network

  tasks-api:
    build:
      context: .
      dockerfile: Tasks.API/Dockerfile
    container_name: tasks-api
    ports:
      - "5002:8080"
    extra_hosts:
      - "ep-small-cell-aiu9egey-pooler.c-4.us-east-1.aws.neon.tech:54.86.249.90"
    env_file:
      - .env
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:8080
      - "ConnectionStrings__DefaultConnection=${NEON_CONNECTION_STRING}"
    networks:
      - microservices-network

  expenses-api:
    build:
      context: .
      dockerfile: Expenses.API/Dockerfile
    container_name: expenses-api
    ports:
      - "5003:8080"
    extra_hosts:
      - "ep-small-cell-aiu9egey-pooler.c-4.us-east-1.aws.neon.tech:54.86.249.90"
    env_file:
      - .env
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:8080
      - "ConnectionStrings__DefaultConnection=${NEON_CONNECTION_STRING}"
    networks:
      - microservices-network

  notifications-api:
    build:
      context: .
      dockerfile: Notifications.API/Dockerfile
    container_name: notifications-api
    ports:
      - "5004:8080"
    extra_hosts:
      - "ep-small-cell-aiu9egey-pooler.c-4.us-east-1.aws.neon.tech:54.86.249.90"
    env_file:
      - .env
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:8080
      - "ConnectionStrings__DefaultConnection=${NEON_CONNECTION_STRING}"
      - RabbitMQ__ConnectionString=amqp://guest:guest@rabbitmq:5672/
    depends_on:
      - rabbitmq
    networks:
      - microservices-network

  gateway-api:
    build:
      context: .
      dockerfile: Gateway.API/Dockerfile
    container_name: gateway-api
    ports:
      - "8080:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:8080
    depends_on:
      - users-api
      - tasks-api
      - expenses-api
      - notifications-api
    networks:
      - microservices-network

networks:
  microservices-network:
    driver: bridge
